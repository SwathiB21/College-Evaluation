# -*- coding: utf-8 -*-
"""09JAN

Automatically generated by Colab.

Original file is located at
    https://colab.research.google.com/drive/138RdKdRYqKVV0qMOo5QJ8XataucnsxOt
"""

import pandas as pd
import numpy as np

from google.colab import files
uploaded=files.upload()

df=pd.read_csv("edit4.csv")

gender = {'M': 0,'F': 1}
df.gender = [gender[item] for item in df.gender]

df['caste'].replace(['OC','SC','ST','BC_A','BC_B','BC_C','BC_D','BC_E'],[0,1,2,3,4,5,6,7], inplace=True)
df['branch_code'].replace(['CSE','INF','ECE','EEE','MEC','CIV','AUT','CSD','AID','CSI','AI','CSM','PHD','MIN','PHM','CSO','CSW','CSC','CHE','FPT','TEX','CIC','EIE','CME','IPE','ANE','BME','CST','ETM','MMS','MTE','MET','CSN','CSB','FDS','ECM','ITE','PHE','BIO','AGR','MCT','MMT','DRG','ECI','DTD','FSP','PLG'],[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46],inplace=True)

def prediction1(gender,caste,rank,branch):
  mask=pd.DataFrame((df['gender']==gender))
  mask1=pd.DataFrame((df['branch_code']==branch))
  mask2=pd.DataFrame(df['caste']==caste)
  mask3=pd.DataFrame(df['rank']>rank)
  mask4 = df['college_code']
  mask5=df['rank 1']
  mask6=df['college']
  mask=mask.join(mask5)
  mask=mask.join(mask6)
  mask=mask.join(mask1)
  mask=mask.join(mask2)
  mask=mask.join(mask3)
  mask=mask.join(mask4)
  res=pd.DataFrame(mask.loc[(mask['branch_code'] ==True) & (mask['caste']== True) & (mask['gender']==True) & (mask['rank']==True)])
  res.to_csv('new.csv',index=False)
  res1=pd.read_csv('new.csv')
  res2=pd.DataFrame(res1['college_code'].drop_duplicates())
  res3=pd.DataFrame(res1['rank 1'].drop_duplicates())
  res4=pd.DataFrame(res1['college'].drop_duplicates())
  res2=res2.join(res3)
  res2=res2.join(res4)
  res2.sort_values(["rank 1"],axis=0, ascending=True,inplace=True,na_position='first')
  res2.to_csv('abhinav.csv')
  df1=pd.read_csv('abhinav.csv')
  res5=pd.DataFrame(df1['college_code'])
  res6=pd.DataFrame(df1['college'])
  res5=res5.join(res6)
  res5.to_csv('finaloutput.csv')
  out=pd.read_csv('finaloutput.csv')
  return out.head()

pip install anvil

!pip install anvil-uplink

import anvil.server
anvil.server.connect("server_PLTNHXLYAHPY77GEHPCLZFCJ-XZVBQ7OQNCBWG7UB")
@anvil.server.callable
def predict(gender,caste,rank,branch):
  final=prediction1(gender,caste,rank,branch)
  print(final)
anvil.server.wait_forever()

